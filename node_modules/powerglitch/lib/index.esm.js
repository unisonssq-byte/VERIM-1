var E=Object.defineProperty,_=Object.defineProperties,$=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,p=(t,e,r)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,f=(t,e)=>{for(var r in e||(e={}))P.call(e,r)&&p(t,r,e[r]);if(m)for(var r of m(e))C.call(e,r)&&p(t,r,e[r]);return t},G=(t,e)=>_(t,$(e));const y=(t="always")=>({playMode:t,optimizeSeo:!0,createContainers:!0,hideOverflow:!1,timing:t==="always"?{duration:2*1e3,iterations:1/0}:{duration:250,iterations:1},glitchTimeSpan:t==="always"?{start:.5,end:.7}:{start:0,end:1},shake:{velocity:15,amplitudeX:.2,amplitudeY:.2},slice:t==="click"?{count:15,velocity:20,minHeight:.02,maxHeight:.15,hueRotate:!0,cssFilters:""}:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0,cssFilters:""},pulse:!1}),v=(t,e)=>{if(!t.glitchTimeSpan)return 1;const r=t.glitchTimeSpan.start,a=t.glitchTimeSpan.end;if(e<r||e>a)return 0;const n=r+(a-r)/2;return e<n?(e-r)/(n-r):(a-e)/(a-n)},u=(t,e)=>(Math.random()-.5)*2*v(t,e),b=({minHeight:t,maxHeight:e,minWidth:r,maxWidth:a})=>{const n=Math.floor(Math.random()*((e-t)*100+1))+t*100,s=Math.floor(Math.random()*((a-r)*100+1))+r*100,i=Math.floor(Math.random()*(100-n)),l=Math.floor(Math.random()*(100-s)),h=`${l+s}% ${i}%`,c=`${l+s}% ${i+n}%`,o=`${l}% ${i+n}%`,d=`${l}% ${i}%`;return`polygon(${h},${c},${o},${d})`},M=t=>{const e=Math.floor(t.slice.velocity*t.timing.duration/1e3)+1,r=[];for(let a=0;a<e;++a){if(v(t,a/e)===0){r.push({opacity:"0",transform:"none",clipPath:"unset"});continue}const s={opacity:"1",transform:`translate3d(${u(t,a/e)*30}%,0,0)`,clipPath:b({minHeight:t.slice.minHeight,maxHeight:t.slice.maxHeight,minWidth:1,maxWidth:1})};t.slice.cssFilters?s.filter=t.slice.cssFilters:t.slice.hueRotate&&(s.filter=`hue-rotate(${Math.floor(u(t,a/e)*360)}deg)`),r.push(s)}return{steps:r,timing:f({easing:`steps(${e},jump-start)`},t.timing)}},A=t=>t.pulse?{steps:[{transform:"scale(1)",opacity:"1"},{transform:`scale(${t.pulse.scale})`,opacity:"0"}],timing:G(f({},t.timing),{delay:(t.glitchTimeSpan?t.glitchTimeSpan.start:0)*t.timing.duration,easing:"ease-in-out"})}:null,x=t=>{if(!t.shake)return{steps:[],timing:{}};const e=Math.floor(t.shake.velocity*t.timing.duration/1e3)+1,r=[];for(let a=0;a<e;++a){const n=u(t,a/e)*t.shake.amplitudeX*100,s=u(t,a/e)*t.shake.amplitudeY*100;r.push({transform:`translate3d(${n}%,${s}%,0)`})}return{steps:r,timing:f({easing:`steps(${e},jump-start)`},t.timing)}},w=t=>[x(t),A(t),...Array.from({length:t.slice.count}).map(()=>M(t))].filter(e=>e!==null),g=(...t)=>{const e=r=>r&&typeof r=="object";return t.reduce((r,a)=>(Object.keys(a).forEach(n=>{e(r[n])&&e(a[n])?r[n]=g(r[n],a[n]):a[n]!==void 0&&(r[n]=a[n])}),r),{})},L=(t,e)=>{var r,a;if(!e.createContainers)return{container:t,layersContainer:t,glitched:t.firstElementChild};if(!t.dataset.glitched){const i=document.createElement("div"),l=document.createElement("div");return getComputedStyle(t).getPropertyValue("display").match(/^inline/)&&(l.style.display="inline-block"),l.appendChild(i),(r=t.parentElement)==null||r.insertBefore(l,t),i.prepend(t),{container:l,layersContainer:i,glitched:t}}const n=t.parentElement,s=(a=t.parentElement)==null?void 0:a.parentElement;for(;n.children.length>1;)n.removeChild(n.children[1]);return n.firstElementChild.getAnimations().forEach(i=>i.cancel()),{container:s,layersContainer:n,glitched:t}},O=(t,e,r)=>{const{glitched:a,container:n,layersContainer:s}=L(t,r);s.style.display="grid",r.hideOverflow&&(n.style.overflow="hidden"),r.html&&(a.innerHTML=r.html),a.style.gridArea="1/1/-1/-1";const i=a.cloneNode(!0);i.dataset.islayer="true",i.style.gridArea="1/1/-1/-1",i.style.userSelect="none",i.style.pointerEvents="none",i.style.opacity="0";for(let c=0;c<e.length-1;++c){const o=i.cloneNode(!0);s.appendChild(o)}const l=()=>{e.forEach((c,o)=>{s.children[o].animate(c.steps,c.timing)})},h=()=>{e.forEach((c,o)=>{s.children[o].getAnimations().forEach(d=>{d.cancel()})})};switch(n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,r.playMode){case"always":l();break;case"hover":n.onmouseenter=l,n.onmouseleave=h;break;case"click":n.onclick=()=>{h(),l()};break}return t.dataset.glitched="1",{container:n,startGlitch:l,stopGlitch:h}},H=(t=".powerglitch",e={})=>{const r=g(y(e.playMode),e);if(r.optimizeSeo&&/google|bing|baidu|yandex|slurp|bot/i.exec(navigator.userAgent))return{containers:[],startGlitch:()=>{console.warn("PowerGlitch disabled")},stopGlitch:()=>{console.warn("PowerGlitch disabled")}};let a=[];typeof t=="string"?a=Array.from(document.querySelectorAll(t)):t instanceof NodeList?a=Array.from(t):Array.isArray(t)?a=t:t instanceof HTMLElement&&(a=[t]);const n=w(r),s=a.filter(i=>!i.dataset.islayer).map(i=>O(i,n,r));return{containers:s.map(i=>i.container),startGlitch:()=>s.forEach(i=>i.startGlitch()),stopGlitch:()=>s.forEach(i=>i.stopGlitch())}},R={glitch:H,generateLayers:w,getDefaultOptions:y};export{R as PowerGlitch,g as mergeOptions};
