(function(d,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],c):(d=typeof globalThis!="undefined"?globalThis:d||self,c(d.PowerGlitch={},d.React))})(this,function(d,c){"use strict";var w=Object.defineProperty,E=Object.defineProperties,M=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,y=(e,t,i)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,m=(e,t)=>{for(var i in t||(t={}))S.call(t,i)&&y(e,i,t[i]);if(g)for(var i of g(t))O.call(t,i)&&y(e,i,t[i]);return e},k=(e,t)=>E(e,M(t));const v=(e="always")=>({playMode:e,optimizeSeo:!0,createContainers:!0,hideOverflow:!1,timing:e==="always"?{duration:2*1e3,iterations:1/0}:{duration:250,iterations:1},glitchTimeSpan:e==="always"?{start:.5,end:.7}:{start:0,end:1},shake:{velocity:15,amplitudeX:.2,amplitudeY:.2},slice:e==="click"?{count:15,velocity:20,minHeight:.02,maxHeight:.15,hueRotate:!0}:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0},pulse:!1}),b=(e,t)=>{if(!e.glitchTimeSpan)return 1;const i=e.glitchTimeSpan.start,o=e.glitchTimeSpan.end;if(t<i||t>o)return 0;const n=i+(o-i)/2;return t<n?(t-i)/(n-i):(o-t)/(o-n)},u=(e,t)=>(Math.random()-.5)*2*b(e,t),C=({minHeight:e,maxHeight:t,minWidth:i,maxWidth:o})=>{const n=Math.floor(Math.random()*((t-e)*100+1))+e*100,a=Math.floor(Math.random()*((o-i)*100+1))+i*100,r=Math.floor(Math.random()*(100-n)),l=Math.floor(Math.random()*(100-a)),h=`${l+a}% ${r}%`,s=`${l+a}% ${r+n}%`,p=`${l}% ${r+n}%`,f=`${l}% ${r}%`;return`polygon(${h},${s},${p},${f})`},H=e=>{const t=Math.floor(e.slice.velocity*e.timing.duration/1e3)+1,i=[];for(let o=0;o<t;++o){if(b(e,o/t)===0){i.push({opacity:"0",transform:"none",clipPath:"unset"});continue}const n={opacity:"1",transform:`translate3d(${u(e,o/t)*30}%,0,0)`,clipPath:C({minHeight:e.slice.minHeight,maxHeight:e.slice.maxHeight,minWidth:1,maxWidth:1})};e.slice.hueRotate&&(n.filter=`hue-rotate(${Math.floor(u(e,o/t)*360)}deg)`),i.push(n)}return{steps:i,timing:m({easing:`steps(${t},jump-start)`},e.timing)}},P=e=>e.pulse?{steps:[{transform:"scale(1)",opacity:"1"},{transform:`scale(${e.pulse.scale})`,opacity:"0"}],timing:k(m({},e.timing),{delay:(e.glitchTimeSpan?e.glitchTimeSpan.start:0)*e.timing.duration,easing:"ease-in-out"})}:null,j=e=>{if(!e.shake)return{steps:[],timing:{}};const t=Math.floor(e.shake.velocity*e.timing.duration/1e3)+1,i=[];for(let o=0;o<t;++o){const n=u(e,o/t)*e.shake.amplitudeX*100,a=u(e,o/t)*e.shake.amplitudeY*100;i.push({transform:`translate3d(${n}%,${a}%,0)`})}return{steps:i,timing:m({easing:`steps(${t},jump-start)`},e.timing)}},G=e=>[j(e),P(e),...Array.from({length:e.slice.count}).map(()=>H(e))].filter(t=>t!==null),$=(...e)=>{const t=i=>i&&typeof i=="object";return e.reduce((i,o)=>(Object.keys(o).forEach(n=>{t(i[n])&&t(o[n])?i[n]=$(i[n],o[n]):o[n]!==void 0&&(i[n]=o[n])}),i),{})},x=(e,t)=>{var i,o;if(!t.createContainers)return{container:e,layersContainer:e,glitched:e.firstElementChild};if(!e.dataset.glitched){const r=document.createElement("div"),l=document.createElement("div");return getComputedStyle(e).getPropertyValue("display").match(/^inline/)&&(l.style.display="inline-block"),l.appendChild(r),(i=e.parentElement)==null||i.insertBefore(l,e),r.prepend(e),{container:l,layersContainer:r,glitched:e}}const n=e.parentElement,a=(o=e.parentElement)==null?void 0:o.parentElement;for(;n.children.length>1;)n.removeChild(n.children[1]);return n.firstElementChild.getAnimations().forEach(r=>r.cancel()),{container:a,layersContainer:n,glitched:e}},A=(e,t,i)=>{const{glitched:o,container:n,layersContainer:a}=x(e,i);a.style.display="grid",i.hideOverflow&&(n.style.overflow="hidden"),i.html&&(o.innerHTML=i.html),o.style.gridArea="1/1/-1/-1";const r=o.cloneNode(!0);r.dataset.islayer="true",r.style.gridArea="1/1/-1/-1",r.style.userSelect="none",r.style.pointerEvents="none",r.style.opacity="0";for(let s=0;s<t.length-1;++s){const p=r.cloneNode(!0);a.appendChild(p)}const l=()=>{t.forEach((s,p)=>{a.children[p].animate(s.steps,s.timing)})},h=()=>{t.forEach((s,p)=>{a.children[p].getAnimations().forEach(f=>{f.cancel()})})};switch(n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,i.playMode){case"always":l();break;case"hover":n.onmouseenter=l,n.onmouseleave=h;break;case"click":n.onclick=()=>{h(),l()};break}return e.dataset.glitched="1",{container:n,startGlitch:l,stopGlitch:h}},T=(e=".powerglitch",t={})=>{const i=$(v(t.playMode),t);if(i.optimizeSeo&&/google|bing|baidu|yandex|slurp|bot/i.exec(navigator.userAgent))return{containers:[],startGlitch:()=>{console.warn("PowerGlitch disabled")},stopGlitch:()=>{console.warn("PowerGlitch disabled")}};let o=[];typeof e=="string"?o=Array.from(document.querySelectorAll(e)):e instanceof NodeList?o=Array.from(e):Array.isArray(e)?o=e:e instanceof HTMLElement&&(o=[e]);const n=G(i),a=o.filter(r=>!r.dataset.islayer).map(r=>A(r,n,i));return{containers:a.map(r=>r.container),startGlitch:()=>a.forEach(r=>r.startGlitch()),stopGlitch:()=>a.forEach(r=>r.stopGlitch())}},L={glitch:T,generateLayers:G,getDefaultOptions:v};function R(e){const[t,i]=c.useState(e),[o,n]=c.useState(()=>()=>{}),[a,r]=c.useState(()=>()=>{});return{ref:c.useCallback(h=>{if(!h)return;const s=L.glitch(h,t);n(()=>s.startGlitch),r(()=>s.stopGlitch)},[t]),startGlitch:o,stopGlitch:a,setOptions:i}}d.useGlitch=R,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
